<!DOCTYPE html>
<html>
<head>
    <title>股票下單</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        form {
            width: 300px;
            margin: 0 auto;
        }

        label, input {
            display: block;
            margin-bottom: 10px;
        }

        button {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
<h1>股票下單</h1>
<form action="/place_order" method="POST" id="order-form">
    <label for="stock_symbol">股票代號：</label>
    <input type="text" id="stock_symbol" name="stock_symbol" required>
    <label for="action">操作：</label>
    <select id="action" name="action" required>
        <option value="buy">買進</option>
        <option value="sell">賣出</option>
    </select>
    <label for="quantity">數量：</label>
    <input type="number" id="quantity" name="quantity" required>
    {#    <label for="price">價格：</label>#}
    {#    <input type="number" id="price" name="price" required>#}
    <button type="submit">送出</button>
</form>
<div id="inventory">
    <h2>庫存股票</h2>
    <table id="inventory-table">
        <thead>
        <tr>
            <th>股票代號</th>
            <th>數量</th>
        </tr>
        </thead>
        <tbody>
        <!-- 库存股票信息将通过 JavaScript 动态填充到这里 -->
        </tbody>
    </table>
</div>
<style>
    /* 添加一些樣式來美化表格 */
    #inventory {
        margin-top: 20px;
    }

    #inventory h2 {
        font-size: 24px;
        margin-bottom: 10px;
    }

    #inventory-table {
        width: 100%;
        border-collapse: collapse;
        border: 1px solid #ddd;
    }

    #inventory-table th, #inventory-table td {
        padding: 8px;
        text-align: left;
    }

    #inventory-table th {
        background-color: #f2f2f2;
        font-weight: bold;
    }

    #inventory-table tr:nth-child(even) {
        background-color: #f2f2f2;
    }

    #inventory-table tr:hover {
        background-color: #ddd;
    }
</style>
<script>
    // 在页面加载时执行的 JavaScript 代码
    window.onload = function () {
        // 获取表单和库存元素
        var orderForm = document.getElementById("order-form");
        var inventoryTable = document.getElementById("inventory-table");

        // 向服务器请求库存数据并动态填充到表格中
        function refreshInventory() {
            fetch("/get_inventory")
                .then(response => response.json())  // 使用 response.json() 解析 JSON 數據
                .then(data => {
                    // 清空表格內容
                    inventoryTable.querySelector("tbody").innerHTML = "";

                    // 將庫存數據添加到表格中
                    data.forEach(item => {
                        var row = inventoryTable.insertRow();
                        var stockSymbolCell = row.insertCell(0);
                        var quantityCell = row.insertCell(1);
                        stockSymbolCell.textContent = item.stock_symbol;
                        quantityCell.textContent = item.quantity;
                    });
                });
        }

        // 提交表单时，阻止默认提交，使用 fetch 请求后端进行下单操作，然后刷新库存
        orderForm.addEventListener("submit", function (event) {
            event.preventDefault();
            fetch("/place_order", {method: "POST"})
                .then(response => response.text())
                .then(data => {
                    // 在下单后，刷新库存数据
                    refreshInventory();
                });
        });

        // 页面加载时初始刷新一次库存数据
        refreshInventory();
    };
</script>
</body>
</html>
